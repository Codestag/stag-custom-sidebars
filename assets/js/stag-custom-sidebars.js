// Generated by CoffeeScript 1.6.3
(function() {
  var $, StagCustomSidebars;

  $ = jQuery;

  StagCustomSidebars = (function() {
    function StagCustomSidebars() {
      this.widget_wrap = $('.widget-liquid-right');
      this.widget_area = $('#widgets-right');
      this.widget_add = $('#tmpl-stag-add-widget');
      this.create_form();
      this.add_elements();
      this.events();
    }

    StagCustomSidebars.prototype.create_form = function() {
      this.widget_wrap.append(this.widget_add.html());
      this.widget_name = this.widget_wrap.find('input[name="stag-add-widget"]');
      this.nonce = this.widget_wrap.find('input[name="scs-delete-nonce"]').val();
    };

    StagCustomSidebars.prototype.add_elements = function() {
      this.widget_area.find('.sidebar-stag-custom').append('<span class="scs-area-delete">&#10006;</span>');
      this.widget_area.find('.sidebar-stag-custom').each(function() {
        var id, where_to_add;
        where_to_add = $(this).find('.widgets-sortables');
        id = where_to_add.attr('id').replace('sidebar-', '');
        where_to_add.prepend("<div class='sidebar-description'><p class='description'>" + objectL10n.shortcode + ": <code>[stag_sidebar id='" + id + "']</code></p></div>");
      });
    };

    StagCustomSidebars.prototype.events = function() {
      this.widget_wrap.on('click', '.scs-area-delete', $.proxy(this.delete_sidebar, this));
    };

    StagCustomSidebars.prototype.delete_sidebar = function(e) {
      var obj, spinner, title, widget, widget_name;
      widget = $(e.currentTarget).parents('.widgets-holder-wrap:eq(0)');
      title = widget.find('.sidebar-name h3');
      spinner = title.find('.spinner');
      widget_name = $.trim(title.text());
      obj = this;
      $.ajax({
        type: "POST",
        url: window.ajaxurl,
        data: {
          action: 'stag_ajax_delete_custom_sidebar',
          name: widget_name,
          _wpnonce: obj.nonce
        },
        beforeSend: function() {
          spinner.addClass('activate');
        },
        success: function(response) {
          if (response === "sidebar-deleted") {
            widget.slideUp(200, function() {
              $('.widget-control-remove', widget).trigger('click');
              widget.remove();
              obj.widget_area.find('.widgets-holder-wrap .widgets-sortables').each(function(i) {
                $(this).attr({
                  id: "sidebar-" + (i + 1)
                });
              });
              wpWidgets.saveOrder();
            });
          }
        }
      });
    };

    return StagCustomSidebars;

  })();

  $(function() {
    var sidebar;
    return sidebar = new StagCustomSidebars();
  });

}).call(this);
